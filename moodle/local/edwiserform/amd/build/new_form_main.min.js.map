{"version":3,"sources":["new_form_main.js"],"names":["define","$","ajax","notification","Templates","get_form_def","get_form_settings","formeo","SELECTORS","FORMTYPE","COMPONENT","FORM_STYLE","RENDER_FORM","PANEL","TEMPLATE_OVERLAY","TITLE","ACTIVE","FORM_TITLE","container","document","querySelector","renderContainer","saved","formeoOpts","svgSprite","M","cfg","wwwroot","localStorage","PROMISES","GET_TEMPLATE","type","call","methodname","args","name","CREATE_NEW_FORM","settings","formdef","setting","toString","UPDATE_FORM","can_save_form","status","check_template","check_title","empty_form_definition","parents","toggleClass","length","switch_panel","id","removeClass","addClass","showError","arguments","undefined","active","attr","emptytitle","title","dom","toaster","util","get_string","JSON","parse","Object","keys","fields","save_form_settings","action","callable","done","fail","ex","alert","message","change_heading","formName","text","show","hide","select_template","formtype","template","val","changeEvent","CustomEvent","target","dispatchEvent","Formeo","trigger","resetForm","loading","response","loadingClose","definition","exception","get_pro_demo_url","video","videotypes","hasOwnProperty","description","notifi_email","draftitemid","data_edit","prop","formData","init","sitekey","prourl","ready","e","formdefinition","click","this","closest","mouseenter","find","css","offset","top","mouseleave","label","parent","detach","prependTo","data","on","event","detail","collapsed","preventDefault","eleCont","render","validator","validate","formid","_action","form_create_action","window","onbeforeunload","msg","reset","location","setTimeout","form_update_action","multiActions","keyup","empty","change","proWarning","_this","select","initializeEvents"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'local_edwiserform/efb_form_basic_settings',\n    './iefixes',\n    'local_edwiserform/formbuilder'\n], function ($, ajax, notification, Templates) {\n\n    var SELECTORS = {\n        FORMTYPE: '#id_type',\n        COMPONENT: 'local_edwiserform',\n        FORM_STYLE: '.efb-form-style',\n        RENDER_FORM: '.render-form',\n        PANEL: '.efb-panel-btn',\n        TEMPLATE_OVERLAY: '.efb-forms-template-overlay',\n        TITLE: '#id_title',\n        ACTIVE: 'active',\n        FORM_TITLE: '#efb-form-title'\n    };\n\n    let container = document.querySelector('.build-form');\n    let renderContainer = document.querySelector(SELECTORS.RENDER_FORM);\n    let saved = false;\n    var fastselect = null;\n    var get_form_def;\n    var get_form_settings;\n    var formeo;\n    let formeoOpts = {\n        container: container,\n        svgSprite: M.cfg.wwwroot + '/local/edwiserform/pix/formeo-sprite.svg',\n        localStorage: false,\n    };\n\n    var PROMISES = {\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  type Type of form\n         * @return {Promise}      Ajax promise call\n         */\n        GET_TEMPLATE: function(type) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_template',\n                args: {\n                    name: type\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings JSON form settings\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        CREATE_NEW_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_create_new_form\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings form settings object\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        UPDATE_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_update_form_settings\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        }\n    };\n\n    /**\n     * Check whether admin/teacher can save current form\n     * @return {Boolean} True is admin/teacher can save form\n     */\n    function can_save_form() {\n        var status = check_template() && check_title(false) && !empty_form_definition();\n        $('#efb-btn-save-form-settings').parents('.efb-editor-button').toggleClass('d-none', !status);\n        $('.efb-form-save').toggleClass('d-none', !status);\n        return status;\n    }\n\n    /**\n     * Reset form definition to selected template\n     */\n    formeoOpts.resetForm = function() {\n        formeo.dom.loading();\n        var formtype = $(SELECTORS.FORMTYPE).val();\n        PROMISES.GET_TEMPLATE(formtype)\n        .done(function(response) {\n            formeo.dom.loadingClose();\n            if (response.status == true) {\n                formeoOpts.container = container;\n                formeo = new Formeo(formeoOpts, response.definition);\n                return;\n            }\n        }).fail(function(ex) {\n            formeo.dom.loadingClose();\n            notification.exception(ex);\n        });\n    };\n\n    /**\n     * Get pro feature demo url of youtube video\n     * @param  {string} video type of feature\n     * @return {string}       Youtube embed video url\n     */\n    formeoOpts.get_pro_demo_url = function(video) {\n        return videotypes.hasOwnProperty(video) ? videotypes[video] : videotypes['default'];\n    };\n\n    /**\n     * Check whether template is selected or not\n     * @return {Boolean} False if not selected\n     */\n    function check_template() {\n        return $('.efb-forms-template.active').length > 0;\n    }\n\n    /**\n     * Switch between panel\n     * @param  {String} id Panel id\n     */\n    function switch_panel(id) {\n        $(SELECTORS.PANEL).removeClass(SELECTORS.ACTIVE);\n        $('#efb-' + id).addClass(SELECTORS.ACTIVE);\n        $('.efb-tabcontent').removeClass(SELECTORS.ACTIVE);\n        $('#efb-cont-' + id).addClass(SELECTORS.ACTIVE);\n    }\n\n    /**\n     * Check title of form and prevent from switching template\n     * @param  {Boolean} showError if true then error will be shown\n     * @return {Boolean}           True if title is empty\n     */\n    function check_title(showError = true) {\n        settings = get_form_settings();\n        var active = $('.efb-panel-btn.active').attr('id');\n        var emptytitle = settings.title != '';\n        if (!showError) {\n            return emptytitle;\n        }\n        if (!emptytitle) {\n            switch(active) {\n                case 'efb-form-setup':\n                case 'efb-form-builder':\n                case 'efb-form-preview':\n                    switch_panel('form-settings');\n                case 'efb-form-settings':\n                    $(SELECTORS.TITLE).parents('.fitem').addClass('has-danger');\n                    break;\n            }\n            formeo.dom.toaster(M.util.get_string('lbl-title-warning', SELECTORS.COMPONENT), 3000);\n        } else {\n            $('.efb-form-title-container').removeClass('has-danger');\n            $(SELECTORS.TITLE).parents('.fitem').removeClass('has-danger');\n        }\n        return emptytitle;\n    }\n\n    /**\n     * Get form settings\n     * @return {Object} form settings\n     */\n    get_form_settings = function() {\n        var type = $(SELECTORS.FORMTYPE).val();\n        var data = {\n            \"title\": $(\"#id_title\").val(),\n            \"description\": $(\"#id_description\").val(),\n            \"type\": type,\n            \"notifi_email\": $(\"#id_notifi_email\").val(),\n            \"message\": $(\"#id_confirmation_msg\").val(),\n            \"draftitemid\": $('[name=\"confirmation_msg[itemid]\"]').val(),\n            \"data_edit\": $(\"#id_editdata\").prop('checked')\n        };\n        return data;\n    }\n\n    /**\n     * Get form definition from formeo object\n     * @return {Object} Json form data\n     */\n    get_form_def = function() {\n        return formeo.formData;\n    }\n\n    /**\n     * Check if form is empty\n     * @return {Boolean} True if empty\n     */\n    function empty_form_definition() {\n        formdef = JSON.parse(get_form_def());\n        return Object.keys(formdef.fields).length == 0;\n    }\n\n    /**\n     * Call ajax service to save form settings\n     * @param {String}   action     Service name\n     * @param {Object}   settings   Form settings\n     * @param {String}   formdef    Form definition\n     * @param {Function} callable   Callback function\n     */\n    function save_form_settings(action, settings, formdef, callable) {\n        (action == 'create' ? PROMISES.CREATE_NEW_FORM(settings, formdef) : PROMISES.UPDATE_FORM(settings, formdef))\n        .done(callable).fail(function (ex) {\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Change heading of form\n     * @param  {String} formName Name of form\n     */\n    function change_heading(formName) {\n        $(\".efb-form-title\").text(formName);\n        $(\".efb-editor-action\").toggleClass(\"efb-hide\", formName.length < 0);\n        if (formName.length < 0) {\n            $(\"#id_error_template_title\").show();\n        } else {\n            $(\"#id_error_template_title\").hide();\n        }\n    }\n\n    /**\n     * Select clicked/choosen template\n     * @param  {String} formtype Form type\n     * @param  {String} template template definition\n     */\n    function select_template(formtype, template = '') {\n        $(SELECTORS.FORMTYPE).val(formtype);\n        var changeEvent = new CustomEvent(\"change\", {target: $(SELECTORS.FORMTYPE)[0]});\n        $(SELECTORS.FORMTYPE)[0].dispatchEvent(changeEvent);\n        formeoOpts.container = container;\n        formeo = new Formeo(formeoOpts, template);\n        $(\"#efb-form-settings\").trigger('click');\n    }\n\n    /**\n     * Innitialize form events\n     */\n    function initializeEvents() {\n        $('.efb-form-style-container .controls-toggle').click(function() {\n            $(this).parents('.preview-form').toggleClass('show-styles');\n            $('#efb-cont-form-builder .formeo-controls').closest('.build-form').toggleClass('hidden-controls');\n        });\n        $(SELECTORS.FORM_STYLE).mouseenter(function() {\n            $('.form-style-preview').attr('src', $(this).find('img').attr('src')).css('top', $(this).offset().top).show();\n        }).mouseleave(SELECTORS.FORM_STYLE, function() {\n            $('.form-style-preview').attr('src', '').hide();\n        });\n\n        let label = $('#id_allowsubmissionsfromdate_enabled').parent();\n        let container = $(label).parent();\n        label.detach().prependTo(container);\n        label = $('#id_allowsubmissionstodate_enabled').parent();\n        container = $(label).parent();\n        label.detach().prependTo(container);\n\n        $('.efb-settings-tab-list-item').click(function() {\n            $('.efb-settings-tab-list-item').removeClass(SELECTORS.ACTIVE);\n            $(this).addClass(SELECTORS.ACTIVE);\n            $('.efb-settings-tab').removeClass(SELECTORS.ACTIVE);\n            $('#' + $(this).data('target')).addClass(SELECTORS.ACTIVE);\n        });\n\n        $(document).on('formeoUpdated', function(event) {\n            can_save_form();\n        });\n        $(document).on('controlsCollapsed', function(event) {\n            $('.efb-form-step-preview').toggleClass('collapsed', event.detail.collapsed);\n        });\n\n        $(\".efb-form-step\").click(function(event) {\n            event.preventDefault();\n            var id = $(this).data('id');\n            $('#' + id).click();\n        });\n        $(\".efb-panel-btn\").click(function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            var id = $(this).attr('id');\n            if (id != 'efb-form-setup' && id != 'efb-form-settings' && !check_title()) {\n                return 0;\n            }\n            can_save_form();\n            var eleCont = $(this).data(\"panel\");\n            $(\"#efb-form-settings, #efb-form-builder, #efb-form-preview, #efb-form-setup\").removeClass(\"active\");\n            $(\"#efb-cont-form-settings, #efb-cont-form-builder, #efb-cont-form-preview, #efb-cont-form-setup\").removeClass(\"active\");\n\n            $(eleCont).addClass(\"active\");\n            $(this).addClass(\"active\");\n            $(\".efb-forms-panel-heading\").text($(this).data(\"panel-lbl\"));\n\n            if (\"#efb-cont-form-preview\" == eleCont) {\n                formeo.render(renderContainer);\n            }\n        });\n\n        // This will save the form settings using ajax.\n        $(\"body\").on(\"click\", \"#efb-btn-save-form-settings\", function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            if (!check_title() || !formeo.validator.validate()) {\n                return 0;\n            }\n            var settings = get_form_settings();\n            var formdef = get_form_def();\n            var formid = $(\"[name='id']\").val();\n            var action = \"create\";\n            var form_create_action = function (response) {\n                if (response.status == true) {\n                    saved = true;\n                    window.onbeforeunload = null;\n                    formeo.dom.alert('success', response.msg, function() {\n                        formeo.reset();\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    });\n                    setTimeout(function() {\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    }, 4000);\n                } else {\n                    formeo.dom.alert('danger', response.msg);\n                }\n            }\n            if (formid) {\n                var form_update_action = function (response) {\n                    if (response.status == true) {\n                        window.onbeforeunload = null;\n                        formeo.dom.multiActions(\n                            'success',\n                            M.util.get_string(\"success\", SELECTORS.COMPONENT),\n                            response.msg,\n                            [{\n                                title: M.util.get_string(\"heading-listforms\", SELECTORS.COMPONENT),\n                                type: 'primary',\n                                action: function() {\n                                    $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                                }\n                            }, {\n                                title: M.util.get_string(\"close\", SELECTORS.COMPONENT),\n                                type: 'default'\n                            }]\n                        );\n                    } else {\n                        formeo.dom.alert('danger', response.msg);\n                    }\n                }\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"forms-update-confirm\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string(\"forms-update-create-new\", SELECTORS.COMPONENT),\n                        type: 'primary',\n                        action: function() {\n                            save_form_settings(action, settings, formdef, form_create_action);\n                        }\n                    }, {\n                        title: M.util.get_string(\"forms-update-overwrite-existing\", SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: function() {\n                            action = \"update\";\n                            settings[\"id\"] = formid;\n                            save_form_settings(action, settings, formdef, form_update_action);\n                        }\n                    }]\n                );\n                return;\n            }\n            if (!saved) {\n                save_form_settings(action, settings, formdef, form_create_action);\n            } else {\n                formeo.dom.toaster(M.util.get_string('form-setting-saved', SELECTORS.COMPONENT), 3000);\n            }\n        });\n\n        $(SELECTORS.FORM_TITLE).keyup(function () {\n            var formName = $(this).val();\n            var empty = formName == '';\n            $(this).parent().toggleClass('has-danger', empty);\n            $(\"#id_title\").val(formName);\n            change_heading(formName);\n        }).change(function() {\n            can_save_form();\n        });\n        $(\"#id_title\").keyup(function () {\n            var formName = $(this).val();\n            $(\"#id_title\").val(formName);\n            change_heading(formName);\n        }).change(function() {\n            var formName = $(this).val();\n            $(SELECTORS.FORM_TITLE).val(formName);\n            can_save_form();\n        });\n\n        $(SELECTORS.FORMTYPE).change(function() {\n            $(\".efb-forms-template\").removeClass(\"active\");\n            var type = $(this).val();\n            $(\"#efb-forms-template-\" + type).addClass(\"active\");\n            $('#id_registration-enabled').prop('checked', true);\n        });\n\n        $(\".efb-forms-template.pro\").click(function() {\n            formeo.dom.proWarning({\n                type: $(this).find('.efb-forms-template-name').text(),\n                video: $(this).data('template'),\n                message: $(this).find('.efb-forms-template-details .desc').text()\n            });\n        });\n        $(\".efb-forms-template-select\").click(function(event){\n            var _this = this;\n            can_save_form();\n            var select = function() {\n                var formtype = $(_this).data(\"template\");\n                $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).addClass('loading');\n                PROMISES.GET_TEMPLATE(formtype)\n                .done(function(response) {\n                    $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n                    if (response.status == true) {\n                        select_template(formtype, response.definition);\n                        return;\n                    }\n                    formeo.dom.alert('warning', response.msg, function() {\n                        select_template(formtype, response.definition);\n                    });\n                }).fail(function(ex) {\n                    $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n                    formeo.dom.alert('danger', ex.message);\n                });\n            }\n            if ($(\".efb-forms-template.active\").length && !empty_form_definition()) {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"template-change-warning\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string('proceed', SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: select\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'success'\n                    }]\n                );\n            } else {\n                select();\n            }\n        });\n\n        can_save_form();\n    }\n\n    var init = function(sitekey, prourl) {\n        formeoOpts.sitekey = sitekey;\n        formeoOpts.prourl = prourl;\n        $(document).ready(function (e) {\n            if (typeof formdefinition != 'undefined') {\n                formeo = new Formeo(formeoOpts, formdefinition);\n            } else {\n                formeoOpts.localStorage = true;\n                formeo = new Formeo(formeoOpts);\n            }\n            initializeEvents();\n            $('#id_type').closest('.fitem').hide();\n            $('#root-page-loading').hide();\n            $('.efb-form-builder-wrap').show();\n        });\n    }\n    return {\n        init: init\n    };\n});\n"],"file":"new_form_main.min.js"}