{"version":3,"sources":["efb_form_basic_settings.js"],"names":["define","$","document","ready","addEmail","index","email","classes","emailElement","createElement","html","attr","Math","floor","random","length","deleteEmail","append","insertBefore","children","changeToEmailTag","edit","editing","data","test","emails","indexOf","validateEditEmail","val","showEmailError","M","util","get_string","remove","join","hideEmailError","get_body_tags","tags","container","each","tag","info","parent","prepend","hide","after","id","string","click","this","on","next","toggleClass","text","hasClass","parents","siblings","trim","show","addClass","removeClass","checkAndAdd","elem","validateEmail","nextIndex","push","split","splice","focus","changeToEmailEdit","event","keyCode","slice","preventDefault"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\ndefine(['jquery'], function ($) {\n    $(document).ready(function() {\n        function validateEmail(email) {\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {\n                if (emails.indexOf(email) != -1) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n        function validateEditEmail(index, email) {\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {;\n                if (emails.indexOf(email) != -1 && emails.indexOf(email) != index) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n        function addEmail(index, email) {\n            var classes = [\n                'primary',\n                'warning',\n                'success',\n                'info',\n            ];\n            var emailElement = document.createElement(\"span\");\n            $(emailElement).html(email);\n            $(emailElement).attr(\"data-email\", email);\n            $(emailElement).attr(\"class\", 'email-tag btn btn-' + classes[Math.floor((Math.random() * classes.length))]);\n            var deleteEmail = document.createElement(\"span\");\n            $(deleteEmail).attr(\"class\", \"email-tag-delete\");\n            $(deleteEmail).html(\"X\");\n            $(emailElement).append($(deleteEmail));\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n        }\n        function changeToEmailEdit(tag) {\n            let email = $(tag).data('email');\n            let index = $(\".email-tag\").index(tag);\n            editing = index;\n            var emailElement = document.createElement(\"input\");\n            $(tag).remove();\n            $(emailElement).val(email);\n            $(emailElement).attr(\"class\", \"notifi-email-group-edit\");\n            $(emailElement).attr(\"data-index\", index);\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n            $(emailElement).focus();\n        }\n        function changeToEmailTag(edit) {\n            if (editing != -1) {\n                var index = $(edit).data('index');\n                var status = validateEditEmail(index, $(edit).val());\n                switch (status) {\n                    case 0:\n                        showEmailError(M.util.get_string(\"lbl-notifi-email-warning\", \"local_edwiserform\"));\n                        return;\n                    case 1:\n                        editing = -1;\n                        let email = $(edit).val();\n                        $(edit).remove();\n                        addEmail(index, email);\n                        emails[index] = email;\n                        $(\"#id_notifi_email\").val(emails.join(','));\n                        hideEmailError();\n                        return;\n                    case 2:\n                        showEmailError(M.util.get_string(\"lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                        return;\n                }\n            }\n        }\n        $(\"#id_notifi_email\").parent().prepend('<div class=\"notifi-email-group\"><input type=\"email\" class=\"notifi-email-group-input form-control\" id=\"notifi-email-group-input\"/><div>' + M.util.get_string('recipient-email-desc', 'local_edwiserform') + '</div></div>');\n        $(\"#id_notifi_email\").hide();\n        $('#id_notifi_email_body').after(M.util.get_string('email-body-restore-desc', 'local_edwiserform', {\n            id: '#id_notifi_email_bodyeditable',\n            string: 'notify-email-body'\n        }));\n        $('#id_confirmation_msg').after(M.util.get_string('email-body-restore-desc', 'local_edwiserform', {\n            id: '#id_confirmation_msgeditable',\n            string: 'confirmation-default-msg'\n        }));\n        $('.efb-email-body-restore').click(function() {\n            $($(this).data('id')).html(M.util.get_string($(this).data('string'), 'local_edwiserform'))\n        });\n        function get_body_tags() {\n            var tags = M.util.get_string('email-body-tags', 'local_edwiserform');\n            var container = \"<div class='efb-email-tags show'><ul>\";\n            $.each(tags, function(tag, info) {\n                container += '<li><a href=\"#\" class=\"efb-email-tag\" title=\"' + info + '\">' + tag + '<label class=\"efb-forms-pro-label m-0\">' + M.util.get_string('pro-label', 'local_edwiserform') + '</label></a></li>';\n            });\n            return container += \"</ul></div>\";\n        }\n        $('body').on('click', '.efb-email-show-tags>a', function() {\n            $(this).next().toggleClass('show');\n            $(this).text($(this).next().hasClass('show') ? M.util.get_string('email-hide-tags', 'local_edwiserform') : M.util.get_string('email-show-tags', 'local_edwiserform'));\n        });\n        $(\"#id_notifi_email_body\").parents('.felement').siblings().append(\n            '<div class=\"efb-email-show-tags\"><a href=\"#\">' + M.util.get_string('email-hide-tags', 'local_edwiserform') + '</a>' + get_body_tags() + '</div>'\n        );\n        $(\"#id_confirmation_msg\").parents('.felement').siblings().append(\n            '<div class=\"efb-email-show-tags\"><a href=\"#\">' + M.util.get_string('email-hide-tags', 'local_edwiserform') + '</a>' + get_body_tags() + '</div>'\n        );\n        var emails = $(\"#id_notifi_email\").val().trim();\n        var editing = -1;\n        if (emails.length > 0) {\n            emails = emails.split(\",\");\n        } else {\n            emails = [];\n        }\n        $.each(emails, function(index, email) {\n            addEmail(index, email);\n        });\n        $(\"body\").on(\"click\", \".email-tag-delete\", function() {\n            var email = $(this).parent();\n            var index = $(\".email-tag\").index(email);\n            emails.splice(index, 1);\n            email.remove();\n            $(\"#id_notifi_email\").val(emails.join(','));\n        });\n        $(\"body\").on(\"dblclick\", \".email-tag\", function() {\n            changeToEmailEdit($(this));\n        });\n        $(\"body\").on(\"focusout\", \".notifi-email-group-edit\", function(event) {\n            changeToEmailTag($(this));\n        });\n        $(\"body\").on(\"keyup\", \".notifi-email-group-edit\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 27) {\n                changeToEmailTag($(this));\n            }\n        });\n        function showEmailError(string) {\n            $(\"#id_error_notifi_email\").html(string);\n            $(\"#id_error_notifi_email\").show();\n            $(\"#id_error_notifi_email\").parent(\".felement\").addClass('has-danger');\n        }\n        function hideEmailError() {\n            $(\"#id_error_notifi_email\").hide().parent(\".felement\").removeClass('has-danger');\n            $(\"#id_notifi_email\").val(emails.join(','));\n        }\n        function checkAndAdd(elem) {\n            if ($(elem).val() == '') {\n                hideEmailError();\n                return;\n            }\n            var status = validateEmail($(elem).val());\n            switch (status) {\n                case 0:\n                    showEmailError(M.util.get_string(\"lbl-notifi-email-warning\", \"local_edwiserform\"));\n                    return;\n                case 1:\n                    var nextIndex = $(elem).siblings('.email-tag').length;\n                    var email = $(elem).val().trim();\n                    addEmail(nextIndex, email);\n                    emails.push(email);\n                    $(elem).val('');\n                    hideEmailError();\n                    return;\n                case 2:\n                    showEmailError(M.util.get_string(\"lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                    return;\n            }\n        }\n        $(\"body\").on(\"keyup\", \"#notifi-email-group-input\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 32) { // Enter key or space key.\n                checkAndAdd(this);\n            } else if (event.keyCode == 188) { // Comma key.\n                $(this).val($(this).val().slice(0, -1));\n                checkAndAdd(this);\n            }\n        });\n        $(\"body\").on(\"focusout\", \"#notifi-email-group-input\", function(event) {\n            event.preventDefault();\n            checkAndAdd(this);\n        });\n    });\n});\n"],"file":"efb_form_basic_settings.min.js"}